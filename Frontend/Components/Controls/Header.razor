@using Frontend.Services
@inject LocalCartStorageService LocalCartStorageService
<div class="header">
    <a href="" class="header-logo">
        <img src="images/logo.png" alt="Logo" />
    </a>
    <div class="header-title">Frölunda Arcade</div>

    <button class="cart-btn btn btn-outline-light position-relative" @onclick="ToggleCart">
        🛒
        @if (CartItemCount > 0)
        {
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                @CartItemCount
            </span>
        }
    </button>

</div>

<ShoppingCart Visible="IsCartOpen" OnClose="ToggleCart" />

@code {
    private bool IsCartOpen = false;
    private int CartItemCount;

    protected override void OnInitialized()
    {
        LocalCartStorageService.OnChange += StateHasChanged;
        CartItemCount = LocalCartStorageService.GetCartItemCount();
    }

    public void Dispose()
    {
        LocalCartStorageService.OnChange -= StateHasChanged;
    }

    private void ToggleCart()
    {
        IsCartOpen = !IsCartOpen;
    }
}